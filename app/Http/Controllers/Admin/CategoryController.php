<?php

namespace App\Http\Controllers\Admin;

use App\Models\Category;
use Illuminate\Http\Request;
use App\Http\Controllers\Controller;

/**
 * üìÇ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
 *
 * –ü–æ–∑–≤–æ–ª—è–µ—Ç:
 * üîπ –°–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —Ñ–∞–π–ª–æ–≤)
 * üîπ –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
 */
class CategoryController extends Controller
{
    /**
     * ‚ûï –ú–µ—Ç–æ–¥ store()
     *
     * üì• –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.
     *
     * üîê –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
     *   - title: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —Å—Ç—Ä–æ–∫–∞, –Ω–µ –¥–ª–∏–Ω–Ω–µ–µ 255 —Å–∏–º–≤–æ–ª–æ–≤
     *   - icon: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Å—Ç—Ä–æ–∫–∞, –º–∞–∫—Å–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤
     *   - type: –∑–∞–¥–∞—ë—Ç—Å—è –≤—Ä—É—á–Ω—É—é ('file'), –Ω–µ –∏–∑ —Ñ–æ—Ä–º—ã (‚ö†Ô∏è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–º–µ–Ω—ã)
     *
     * üîÅ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
     *   - –µ—Å–ª–∏ `redirect_back_to_files` –µ—Å—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–µ ‚Äî –Ω–∞–∑–∞–¥ –≤ /admin/files
     *   - –∏–Ω–∞—á–µ ‚Äî –Ω–∞ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
     *
     * @param  \Illuminate\Http\Request  $request
     * @return \Illuminate\Http\RedirectResponse
     */
    public function store(Request $request)
    {
        // ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        $request->validate([
            'title' => 'required|string|max:255',
            'icon'  => 'nullable|string|max:10',
            // üõ°Ô∏è –ñ—ë—Å—Ç–∫–æ –∑–∞–¥–∞—ë–º —Ç–∏–ø ‚Äî –Ω–µ –¥–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–µ
        ]);

        // üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ –±–∞–∑–µ
        Category::create([
            'title' => $request->input('title'),
            'icon'  => $request->input('icon'),
            'type'  => 'file', // üîê –ù–∞—Å–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø
        ]);

        // üîÅ –í–æ–∑–≤—Ä–∞—Ç: –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞ –ø—Ä–∏—à–ª–∞ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ñ–∞–π–ª–æ–≤ ‚Äî –≤–µ—Ä–Ω—É—Ç—å—Å—è —Ç—É–¥–∞
        if ($request->has('redirect_back_to_files')) {
            return redirect()
                ->route('admin.files.index')
                ->with('success', '‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞!');
        }

        // üîÅ –ò–Ω–∞—á–µ –≤–µ—Ä–Ω—ë–º—Å—è –Ω–∞ –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        return redirect()
            ->route('admin.categories.index')
            ->with('success', '‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞!');
    }

    /**
     * üìÑ –ú–µ—Ç–æ–¥ index()
     *
     * üîç –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –∞–¥–º–∏–Ω–∫–µ
     *
     * üìä –ü–∞–≥–∏–Ω–∞—Ü–∏—è: 20 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
     *
     * @return \Illuminate\View\View
     */
    public function index()
    {
        // üì• –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é ID
        $categories = Category::orderByDesc('id')->paginate(20);

        // üñºÔ∏è –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å —Ç–∞–±–ª–∏—Ü–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        return view('admin.categories.index', compact('categories'));
    }
}
